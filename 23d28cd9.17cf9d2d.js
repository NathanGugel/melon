(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{100:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return u}));var a=n(0),o=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var b=o.a.createContext({}),s=function(e){var t=o.a.useContext(b),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=s(e.components);return o.a.createElement(b.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},p=o.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,c=e.parentName,b=l(e,["components","mdxType","originalType","parentName"]),d=s(n),p=a,u=d["".concat(c,".").concat(p)]||d[p]||m[p]||r;return n?o.a.createElement(u,i(i({ref:t},b),{},{components:n})):o.a.createElement(u,i({ref:t},b))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,c=new Array(r);c[0]=p;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:a,c[1]=i;for(var b=2;b<r;b++)c[b]=n[b];return o.a.createElement.apply(null,c)}return o.a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},64:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return i})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return s}));var a=n(2),o=n(6),r=(n(0),n(100)),c={id:"modules",title:"Modules",sidebar_label:"Modules",slug:"/modules"},i={unversionedId:"modules",id:"modules",isDocsHomePage:!1,title:"Modules",description:"Melon has a basic but flexible module system. Modules are used by the core system to expose domain specific functionality to the developer and can also be used by the developer to enhance code re-use.",source:"@site/docs/modules.md",slug:"/modules",permalink:"/melon/docs/modules",editUrl:"https://github.com/daniele-rapagnani/edit/master/docs/docs/modules.md",version:"current",sidebar_label:"Modules",sidebar:"someSidebar",previous:{title:"Operators",permalink:"/melon/docs/operators"},next:{title:"array",permalink:"/melon/docs/modules/array_module"}},l=[{value:"Core modules",id:"core-modules",children:[]},{value:"Importing custom modules",id:"importing-custom-modules",children:[{value:"Import path",id:"import-path",children:[]}]},{value:"Defining custom modules",id:"defining-custom-modules",children:[{value:"Caching",id:"caching",children:[]},{value:"Accessing the cache",id:"accessing-the-cache",children:[]}]}],b={rightToc:l};function s(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},b,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"Melon has a basic but flexible module system. Modules are used by the core system to expose domain specific functionality to the developer and can also be used by the developer to enhance code re-use."),Object(r.b)("h2",{id:"core-modules"},"Core modules"),Object(r.b)("p",null,"Core modules are exposed through global variables and are pre-defined. One example is the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"/melon/docs/modules/io_module"}),Object(r.b)("inlineCode",{parentName:"a"},"io")," module")," which was used throughout this documentation."),Object(r.b)("h2",{id:"importing-custom-modules"},"Importing custom modules"),Object(r.b)("p",null,"Custom modules must be selectively imported by the developer, to do this ",Object(r.b)("inlineCode",{parentName:"p"},"import")," can be called:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),'let MyModule = import("my-module");\n\nMyModule.doSomething();\n')),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"As will become apparent in the sections below, ",Object(r.b)("inlineCode",{parentName:"p"},"import")," is not a ",Object(r.b)("inlineCode",{parentName:"p"},"Function")," but an ",Object(r.b)("inlineCode",{parentName:"p"},"Object"),".\nIt can be called because it has its ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"/melon/docs/operators#supported-custom-operators"}),Object(r.b)("inlineCode",{parentName:"a"},"call operator"))," overriden, allowing the developer to customise\nits behaviour."))),Object(r.b)("h3",{id:"import-path"},"Import path"),Object(r.b)("p",null,"The first argument of the ",Object(r.b)("inlineCode",{parentName:"p"},"import")," call is used to locate the module's source. How this is done depends on the content of the ",Object(r.b)("inlineCode",{parentName:"p"},"import.paths")," key which contains an ",Object(r.b)("inlineCode",{parentName:"p"},"Array")," of strings:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),'import.paths = [\n    "##/??/index.ms",\n    "##/../??/index.ms"\n];\n')),Object(r.b)("p",null,"The path strings are processed top to bottom until a valid file is found.\nSpecial placeholders can be used inside path strings:"),Object(r.b)("table",null,Object(r.b)("thead",{parentName:"table"},Object(r.b)("tr",{parentName:"thead"},Object(r.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Placeholder"),Object(r.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Meaning"))),Object(r.b)("tbody",{parentName:"table"},Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"??")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The first argument of the ",Object(r.b)("inlineCode",{parentName:"td"},"import")," call")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"##")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"If the current call to ",Object(r.b)("inlineCode",{parentName:"td"},"import")," has been made from ",Object(r.b)("inlineCode",{parentName:"td"},"a/b/c.ms")," then ",Object(r.b)("inlineCode",{parentName:"td"},"##")," is ",Object(r.b)("inlineCode",{parentName:"td"},"a/b"))),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"$$")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The path of the entry-point. For example if your entry point is ",Object(r.b)("inlineCode",{parentName:"td"},"a/b/main.ms")," then ",Object(r.b)("inlineCode",{parentName:"td"},"$$")," is ",Object(r.b)("inlineCode",{parentName:"td"},"a/b"))))),Object(r.b)("p",null,"The default value for ",Object(r.b)("inlineCode",{parentName:"p"},"import.paths")," is:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"##/??\n##/??.ms\n##/??.mbc\n##/??/index.ms\n##/??/index.mbc\n$$/??\n$$/??.ms\n$$/??.mbc\n$$/??/index.ms\n$$/??/index.mbc\n$$/mel_seeds/??.ms\n$$/mel_seeds/??.mbc\n$$/mel_seeds/??/index.ms\n$$/mel_seeds/??/index.mbc\n$$/mel_seeds/??\n??\n")),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},Object(r.b)("inlineCode",{parentName:"p"},"import")," can also import pre-compiled bytecode, that's what the ",Object(r.b)("inlineCode",{parentName:"p"},"mbc")," extension stands for."))),Object(r.b)("h2",{id:"defining-custom-modules"},"Defining custom modules"),Object(r.b)("p",null,"Custom modules are just standard source files which ",Object(r.b)("inlineCode",{parentName:"p"},"return")," a value. The value will be the result of the ",Object(r.b)("inlineCode",{parentName:"p"},"import")," call when the module is imported:"),Object(r.b)("p",null,"In ",Object(r.b)("inlineCode",{parentName:"p"},"a/my-module.ms"),":"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),'return {\n    myVar = 5,\n    myFunc = => { io.print("Hello modules!"); }\n};\n')),Object(r.b)("p",null,"In ",Object(r.b)("inlineCode",{parentName:"p"},"a/some-file.ms"),":"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),'let MyModule = import("my-module");\n\nio.print(MyModule.myVar); // 5\nMyModule.myFunc(); // Hello modules!\n')),Object(r.b)("h3",{id:"caching"},"Caching"),Object(r.b)("p",null,"Modules are cached, this means the the module's code is executed only upon first ",Object(r.b)("inlineCode",{parentName:"p"},"import"),". Then the returned value is cached and the same value is returned to every subsequent ",Object(r.b)("inlineCode",{parentName:"p"},"import")," call. This means that if your module's code has any side-effects they will be executed only once:"),Object(r.b)("p",null,"In ",Object(r.b)("inlineCode",{parentName:"p"},"a/my-module.ms"),":"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),'io.print("Importing!");\n\nreturn {\n    myVar = 5,\n    myFunc = => { io.print("Hello modules!"); }\n};\n')),Object(r.b)("p",null,"In ",Object(r.b)("inlineCode",{parentName:"p"},"a/some-file.ms"),":"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),'let MyModule = import("my-module");\nlet MyModule2 = import("my-module");\n\nMyModule.myFunc(); // Hello modules!\n')),Object(r.b)("p",null,"Running ",Object(r.b)("inlineCode",{parentName:"p"},"some-file.ms")," will output:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"Importing!\nHello modules!\n")),Object(r.b)("h3",{id:"accessing-the-cache"},"Accessing the cache"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"import"),"'s cache is exposed through its ",Object(r.b)("inlineCode",{parentName:"p"},"import.cache")," key which is just an ",Object(r.b)("inlineCode",{parentName:"p"},"Object")," with the key corresponding to the real path on the filesystem of the imported file and the value to the value returned by the module. You can for example clear all ",Object(r.b)("inlineCode",{parentName:"p"},"import"),"'s cache by simply doing:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"import.cache = {};\n")))}s.isMDXComponent=!0}}]);